---
title: 【DB】設計の基礎知識についてまとめてみた
tags:
  - DB
  - DB設計
private: false
updated_at: '2022-03-20T08:51:13+09:00'
id: 5cfc6f7a70b9e8058ff6
organization_url_name: null
slide: false
ignorePublish: false
---
## データベースとは
- データを管理するのがデータベース。
- データベースはテーブルという二次元表で管理されている。
- データベースのイメージは図書館。
![データベース例.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2263192/847c1ff4-b294-9e8e-eaa1-bb512af2957e.png)

- テーブルの構造
![生徒テーブル.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2263192/ab3bbbeb-5b78-982b-2dd2-f8c1f887f051.png)


## データベースの設計
### システム開発の流れ
1. 要件定義
1. 設計
1. 開発
1. テスト

- DB設計も設計の工程の1つ。
### 何をデータとして保存するか。
- システムで使用するもの(商品情報など)
- ユーザーが登録するもの(氏名など)
- **最初にやること**
  - データを抽出する
  - エンティティ(実体)を定義する

### どのような形式で保存するか
- **主キーが必要**
  - 値を指定すれば1行のレコード指定できる
  - テーブル内に必ず1つだけ存在
  - テーブルは重複したデータを持てない
## 正規化
### 第一正規形
  - 正規形：一貫性と効率性を持った形でデータを保持するためのデータ形式
  - 正規化：一貫性と効率性を持つようにデータベースを設計する
  - 第一正規形：1つのセルの中には1つの値しか含まない。効率よく検索できる

**例**
非第一正規形

|社員ID|名前|年齢|性別|被扶養者|
|:--:|:--:|:--:|:--:|:--:|
|S001|赤井　太郎|42|男|けんじ|
|S002|今村　次郎|30|男|ようこ|
|S003|牛田　三郎|62|男|(きょうこ、さとし)|

第一正規形
①社員テーブル

|社員ID|名前|年齢|性別|
|:--:|:--:|:--:|:--:|
|S001|赤井　太郎|42|男|
|S002|今村　次郎|30|男|
|S003|牛田　三郎|62|男|

②社員・扶養者テーブル

|社員ID|被扶養者番号|扶養者名|
|:--:|:--:|:--:|
|S001|1|けんじ|
|S002|2|ようこ|
|S003|3|きょうこ|
|S003|3|さとし|


### 関数従属性
  - y = f(x)：入力xに対して出力yが決まる
  - yはxに従属する：{x}　→　{y}
  - 1つのセルに1つの値の方針も関数従属性
  - テーブル設計ではすべての列が関数従属性を満たすように整理していく
### 第二正規形
  - 第一正規形から部分関数従属を排除
  - 部分関数従属：主キーの一部に対して従属する列がある
  - テーブル分割でデータに矛盾がなくなる

**例**
非第2正規形
|顧客企業ID|注文番号|注文受付日|顧客企業名|顧客企業規模|
|:--:|:--:|:--:|:--:|:--:|
|CA|O001|2014/12/20|A商社|大規模|
|CA|O002|2014/12/21|A商社|大規模|
|CB|O001|2014/12/12|B建設|中規模|
|CB|O002|2014/12/25|B建設|中規模|
|CB|O003|2014/12/25|B建設|中規模|
|CC|O001|2014/12/1|C化学|小規模|

第2正規形
①注文テーブル

|顧客企業ID|注文番号|注文受付日|
|:--:|:--:|:--:|
|CA|O001|2014/12/20|
|CA|O002|2014/12/21|
|CB|O001|2014/12/12|
|CB|O002|2014/12/25|
|CB|O003|2014/12/25|
|CC|O001|2014/12/1|

②顧客企業テーブル

|顧客企業ID|顧客企業名|顧客企業規模|
|:--:|:--:|:--:|
|CA|A商社|大規模|
|CB|B建設|中規模|
|CC|C化学|小規模|


### 第三正規形
  - 第二正規形から推移的関数従属を排除
  - 推移的関数従属：テーブル内に段階的な従属関係がある
  - テーブル分割すると、他のデータと紐付かないデータも登録できる

**例**
非第3正規形

|顧客企業ID|顧客企業名|顧客企業規模|業界コード|業界名|
|:--:|:--:|:--:|:--:|:--:|
|CA|A商社|大規模|D001|石油|
|CB|B建設|中規模|D002|ゼネコン|
|CC|C化学|小規模|D003|バイオ|

第3正規形
①顧客企業テーブル

|顧客企業ID|顧客企業名|顧客企業規模|業界コード|
|:--:|:--:|:--:|:--:|
|CA|A商社|大規模|D001|
|CB|B建設|中規模|D002|
|CC|C化学|小規模|D003|

②業界テーブル

|業界コード|業界名|
|:--:|:--:|
|D001|石油|
|D002|ゼネコン|
|D003|バイオ|


### 正規化のまとめ
- 第三正規化まで正規化すれば基本OK
- 第六正規形まで存在するけど、第三正規形までで充分なケースが多い
- データに矛盾が生じないことが何より重要

## ER図
- テーブルとテーブルを線でつなぎ、中身の種類と関係性を見やすくしたもの
- テーブル間における関係として、1対1、1対多、多対多がある
### 1対1
  - あまり登場しない
  - 1つのテーブルにまとめればOK
![1対1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2263192/b4474f3e-084e-26ed-5171-912d8ff53c2c.png)

### 1対多
  - 一番登場する
  - 正規化によって生まれる関連はこれ
![1対多.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2263192/fa554425-32cf-8a72-b65b-91787f9aafcf.png)
　
### 多対多
  - 多対多は登場するが、テーブル設計上はNG
  - 両方を紐付けることができない
  - 無理やり紐付けると正規化ができてない状態になる
![多対多.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2263192/907d2134-104e-8225-944b-885a704d8549.png)

  - **多対多の対策**
    - 中間テーブルを作る
    - 1対多の関係となる
    - 正規化していけば自然とこの形になる
![多対多の対策.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/2263192/2acf8db2-4753-c9ec-4a78-534206ce1904.png)

### ER図のまとめ
  - テーブルが増えると関係がわかりづらくなる
  - ER図を使うことで関係を整理
  - テーブルの関係は基本的に1対多

## テーブルの定義
- テーブル定義時に考えること
  - テーブル名、カラム名、データ型、PK、NOT NULL、デフォルトを考える
  - 外部キー制約、ユニーク制約、チェック制約、オートインクリメントも考慮すれば完璧

|カラム名|データ型|PK(Primary Key)|NOT NULL|デフォルト|
|:--:|:--:|:--:|:--:|:--:|
||||||

- テーブル定義後にやること
  - インデックスの設定(索引)
  - パフォーマンス向上が目的

## まとめ
- **論理設計**
  - データの抽出、エンティティの定義、正規化、ER図
- **物理設計**
  - テーブルの定義
  - インデックス設計

### 設計のポイント
- 要件を満たすテーブル/カラムを作成する
- 必要データはアプリケーションが決める
- 要件定義をしっかり行う&理解する
- データに矛盾が生じないように正規化する

### 正規化のポイント
- 【第一正規形】：1つのセルに値が1つだけか？
- 【第二正規形】：主キーの一部だけしか利用していないのに一意に定まる列が存在していないか？
- 【第三正規形】：主キー以外の列同士(多段階)で従属する列は存在していないか？


***
参考
[達人に学ぶDB設計 徹底指南書 初級者で終わりたくないあなたへ](https://www.amazon.co.jp/%E9%81%94%E4%BA%BA%E3%81%AB%E5%AD%A6%E3%81%B6DB%E8%A8%AD%E8%A8%88-%E5%BE%B9%E5%BA%95%E6%8C%87%E5%8D%97%E6%9B%B8-%E5%88%9D%E7%B4%9A%E8%80%85%E3%81%A7%E7%B5%82%E3%82%8F%E3%82%8A%E3%81%9F%E3%81%8F%E3%81%AA%E3%81%84%E3%81%82%E3%81%AA%E3%81%9F%E3%81%B8-%E3%83%9F%E3%83%83%E3%82%AF/dp/4798124702)








